# 05. 형식 맞추기

프로그래머라면 형식을 깔끔하게 맞춰 코드를 짜야 한다.  

코드 형식을 맞추기 위한 규칙을 정하고 그 규칙을 따라야 한다. 팀으로 일한다며 팀이 합의해 규칙을 정하고 모두가 그 규칙을 따르고, 필요하다면 규칙을 자동으로 적용하는 도구를 활용한다.  
<br/>
<br/>

### **형식을 맞추는 목적**

코드의 형식은 매우 중요하며, 코드 형식은 의사소통의 일환이다.  

오늘 구현한 기능이 다음 버전에서 바뀔 확률은 아주 높기 때문에, 오늘 구현한 코드의 가독성은 앞으로 바뀔 코드의 품질에 지대한 영향을 미친다.  
<br/>
<br/>

### **적절한 행 길이를 유지하라**

레거시 프로젝트를 보면 자바 소스 파일의 길이가 수백 줄이 아닌 수천 줄이 넘어가는 파일도 많지만, 최근 Junit같은 소스 파일은 500줄 이하로 작성되어 있다. 이처럼 무조건적인 규칙은 아니지만 소스 코드의 길이가 큰 파일보다는 작은 파일이 이해하기 쉽다.  
<br/>

**신문 기사처럼 작성하라**

아주 좋은 신문 기사를 보면 독자는 위에서 아래로 기사를 읽는데, 기사의 표제를 보고 독자는 기사를 읽을지 말지 결정한다.  

소스 파일도 기사처럼 이름만 보고도 모듈을 살펴보고 있는지 아닌지를 판단할 정도로 신경 써서 짓는다.  
<br/>

**개념은 빈 행으로 분리하라**

거의 모든 코드는 왼쪽에서 오른쪽으로 그리고 위에서 아래로 읽힌다. 각 행은 수식이나 절을 나타내고, 일련의 행 묶음은 완결된 생각 하나를 표현한다. 생각 사이는 빈 행을 넣어 분리해야 한다.  

```java
package com.cleancode;

import java.util.*;

public class Member {

	private String name;
	private int age;

	public Member(String name, int age) {
		this.name = name;
		this.age = age;
	}

	public void print() {
		System.out.println("name: " + name + ", age: " + age);
	}
}
```
<br/>

코드에서 패키지 선언부, import문 각 함수 사이에는 빈 행이 들어가는데, 빈 행은 새로운 개념을 시작한다는 시각적 단서이며, 빈 행을 제거하면 코드 가독성이 매우 떨어지게 된다.  
<br/>

**세로 밀집도**

줄 바꿈이 개념을 분리한다면 세로 밀집도는 연관성을 의미한다. 즉, 서로 밀접한 코드 행은 세로로 가까이 놓여야 한다는 뜻이다.  

```java
// 1번
public class Member {
	/**
	 * 회원 이름
	 */
	private String name;

	/**
	 * 회원 나이
	 */
	private int age;

	public void print() {}
}

//2번
public class Member {

	private String name;
	private int age;

	public void print() {}
}
```
<br/>

같은 코드라도 2번 코드가 1번 코드보다 더 읽기 쉽게 느껴진다.  
<br/>

**수직 거리**

서로 밀접한 개념은 세로로 가까이 둬야 한다.

두 개념이 서로 다른 파일에 속한다면 규칙이 통하지 않지만 타당한 근거가 없다면 서로 밀접한 개념은 한 파일에 속해야 마땅하다. protected 변수를 피해야 하는 이유이다.

같은 파일에 속할 정도로 밀접한 두 개념은 세로 거리로 연관성을 표현한다. 여기서 연관성이란 한 개념을 이해하는 데 다른 개념이 중요한 정도이다.  
<br/>

**변수 선언**

변수는 사용하는 위치에 최대한 가까이 선언한다.

우리가 만든 함수는 매우 짧으므로 지역 변수는 각 함수의 맨 처음에 선언한다.  

```java
public void method() {
	int total; // 지역 변수 선언
	... // 코드 작성
}
```
<br/>

루프를 제어하는 변수는 루프 문 내부에서 선언한다. 다소 긴 함수에서 블록 상단이나 루프 직전에 변수를 선언하는 사례도 있다.  

```java
public int sum() {
	int total = 0;
	for (int i = 0; i < 10; i++) {
		total += i;
	}
	
	return total;
}
```
<br/>

**인스턴스 변수**

인스턴스 변수는 클래스 맨 처음에 선언한다. 변수간에 세로로 거리를 두지 않는다.  

일반적으로 C++에서는 모든 인스턴스 변수를 클래스 마지막에 선언한다는 가위 규칙을 적용하고, 자바에서는 클래스 맨 처음에 인스턴스 변수를 선언한다.  
<br/>

**종속함수**

한 함수가 다른 함수를 호출한다면 두 함수는 세로로 가까이 배치한다. 또한 가능하다면 호출하는 함수를 호출되는 함수보다 먼저 배치한다.  
<br/>

**개념적 유사성**

코드의 개념적인 친화도가 높을수록 코드를 가까이 배치한다.  
<br/>

**세로 순서**

호출되는 함수를 호출하는 함수보다 나중에 배치한다. (소스 코드 모듈이 고차원에서 저차원으로 자연스럽게 내려감)

신문 기사처럼 가장 중요한 개념을 먼저 표현하고, 표현 시 세세한 사항을 최대한 배제한다.  
<br/>
<br/>

### **가로 형식 맞추기**

행 길이는 120자 정도로 제한하는 것이 좋다.  
<br/>

**가로 공백과 밀집도**

가로로는 공백을 사용해 밀접한 개념과 느슨한 개념을 표현한다.  

```java
private void measureLine(String line) {
	lineCount++;
	int lineSize = line.length();
	totalChars += lineSize;
	lineWidthHistogram.addLine(lineSize, lineCount);
	recordWidestLine(lineSzie);
}

private double measure(double b, double a, double c) {
	return b*b - 4*a*c;
}
```
<br/>

할당문은 왼쪽 요소와 오른쪽 요소가 분명히 나뉘므로 공백을 넣어 두 가지 주요 요소가 확실히 나뉜다는 시실이 분명해진다.  

함수와 인수는 서로 밀접하기 때문에 공백을 넣으면 한 개념이 아닌 별개로 보일 수 있어서 괄호 사이에 공백을 넣지 않는다. 괄호 안 인수는 공백으로 분리해서 쉼표를 강조해 인수가 별개라는 사실을 보여준다.  

연산의 승수 사이에는 공백을 없에면 읽기 편해진다.  
<br/>

**가로 정렬**

가로 정렬은 별로 유용하지 못하며 코드가 엉뚱한 부분을 강조해 의도가 가려지기 때문에 정렬하지 않는 편이 효율적이다.

```java
// before
public class Member {
	private  String  name;
	private  int     age;
	private  int     membershipPoint;

	public A(String name, int age) {
		this.name =            name;
		this.age =             age;
		this.membershipPoint = 10000;
	}
}

// after
public class Member {
	private String name;
	private int age;
	private int membershipPoint;

	public A(String name, int age) {
		this.name = name;
		this.age = age;
		this.membershipPoint = 10000;
	}
}
```
<br/>

**들여쓰기**

소스 파일은 윤곽도(outline)와 계층이 비슷하다.

클래스에서 적용되는 정보, 메서드에서 적용되는 정보, 블록 내에서 재귀적으로 적용되는 정보 등의 범위로 이뤄진 계층을 표현하기 위해서 들여쓰기를 한다.

클래스 처럼 파일 수준인 문장은 들여쓰지 않고, 클래스 내의 메서드는 클래스보다 한 수준 들여쓴다. 메서드 코드는 메서드보다 한 수준 들여쓰고, 블록코드는 블록을 포함하는 코드보다 한 수준 들여쓴다.  

들여쓰기는 파일의 구조를 한 눈에 확인할 수 있도록 도와준다.  
<br/>

**들여쓰기 무시하기**

들여쓰기를 무시하고 한 행에 범위를 뭉뚱그린 코드를 피하는 것이 좋다.
<br/>

**가짜 범위**

세미콜론(;)은 새 행마다 제대로 들여써서 넣어준다.

```java
while (dis.read(buf, 0, readBufferSize) != -1)
;
```
<br/>
<br/>

### 팀 규칙

팀은 한 가지 규칙에 합의하며 모든 팀원은 그 규칙을 따라야 일관적인 스타일을 보일 수 있다.

개개인이 따로국밥인 코드는 피해야 한다.  
<br/>
<br/>

### 5장 형식 맞추기를 마치며…

마지막 팀 규칙에서 많은 공감이 느껴졌다.

개인 프로젝트를 진행할 때는 내가 모든 코드를 작성하기 때문에 상관없었지만 팀 프로젝트를 진행하고 최종 결과물에서 다른 사람이 작성한 코드를 확인할 때 코드의 문법이 아닌 들여쓰기나 형식 때문에 읽기 힘든 부분들이 있었기 때문이다.

형식이란 부분에 대해 프로젝트를 진행할 때 틀을 잡고 가야할 필요성이 있는 것 같다.